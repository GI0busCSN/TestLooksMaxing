import{a1 as S,j as P,a2 as A,i as m,a3 as G,a4 as O,a5 as j,s as y,a6 as B,a0 as V}from"./index-8r3WLm3c.js";function M(e,t){return O()?(j(e,t),!0):!1}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const x=()=>{};function z(...e){if(e.length!==1)return A(...e);const t=e[0];return typeof t=="function"?S(G(()=>({get:t,set:x}))):m(t)}function I(e,t){function n(...r){return new Promise((a,i)=>{Promise.resolve(e(()=>t.apply(this,r),{fn:t,thisArg:this,args:r})).then(a).catch(i)})}return n}const b=e=>e();function C(e=b,t={}){const{initialState:n="active"}=t,r=z(n==="active");function a(){r.value=!1}function i(){r.value=!0}const s=(...u)=>{r.value&&e(...u)};return{isActive:S(r),pause:a,resume:i,eventFilter:s}}function E(e,t,n={}){const{eventFilter:r=b,...a}=n;return P(e,I(r,t),a)}function K(e,t,n={}){const{eventFilter:r,initialState:a="active",...i}=n,{eventFilter:s,pause:u,resume:l,isActive:p}=C(r,{initialState:a});return{stop:E(e,t,{...i,eventFilter:s}),pause:u,resume:l,isActive:p}}function f(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function T(e,t){let n;const r=()=>{if(n)return n;const a=indexedDB.open(e);return a.onupgradeneeded=()=>a.result.createObjectStore(t),n=f(a),n.then(i=>{i.onclose=()=>n=void 0},()=>{}),n};return(a,i)=>r().then(s=>i(s.transaction(t,a).objectStore(t)))}let h;function d(){return h||(h=T("keyval-store","keyval")),h}function $(e,t=d()){return t("readonly",n=>f(n.get(e)))}function k(e,t,n=d()){return n("readwrite",r=>(r.put(t,e),f(r.transaction)))}function H(e,t,n=d()){return n("readwrite",r=>new Promise((a,i)=>{r.get(e).onsuccess=function(){try{r.put(t(this.result),e),a(f(r.transaction))}catch(s){i(s)}}}))}function J(e,t=d()){return t("readwrite",n=>(n.delete(e),f(n.transaction)))}function Q(e,t,n={}){const{flush:r="pre",deep:a=!0,shallow:i=!1,onError:s=o=>{console.error(o)},writeDefaults:u=!0,serializer:l={read:o=>o,write:o=>o}}=n,p=y(!1),c=(i?y:m)(t),w=B(t);async function F(){try{const o=await $(e);o===void 0?w!=null&&u&&await k(e,l.write(w)):c.value=l.read(o)}catch(o){s(o)}p.value=!0}F();async function v(){try{if(c.value==null)await J(e);else{const o=V(c.value),W=l.write(o);await H(e,()=>W)}}catch(o){s(o)}}const{pause:g,resume:D}=K(c,()=>v(),{flush:r,deep:a});async function R(o){g(),c.value=o,await v(),D()}return{set:R,isFinished:p,data:c}}export{M as t,Q as u};
